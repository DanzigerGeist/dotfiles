{{- $destPath := joinPath .chezmoi.homeDir ".claude.json" -}}
{{- $existing := dict -}}
{{- if (stat $destPath) -}}
  {{- $raw := output "cat" $destPath -}}
  {{- if ne (trim $raw) "" -}}
    {{- $existing = mustFromJson $raw -}}
  {{- end -}}
{{- end -}}

{{- $mcpServers := dict
  "atlassian_yarrl" (dict
    "command" "mcp-atlassian"
    "args" (list "--transport=stdio")
    "env" (dict
      "JIRA_URL" (trim (gopass "yarrl/atlassian/url"))
      "JIRA_USERNAME" (trim (gopass "yarrl/atlassian/user"))
      "JIRA_API_TOKEN" (trim (gopass "yarrl/atlassian/token"))
    )
  )
  "context7" (dict
    "command" "context7-mcp"
    "args" (list)
    "env" (dict
      "CONTEXT7_API_KEY" (trim (gopass "personal/context7/token"))
    )
  )
  "figma" (dict
    "type" "http"
    "url" "https://mcp.figma.com/mcp"
  )
  "genesys_bnp" (dict
    "command" "npx"
    "args" (list "-y" "@makingchatbots/genesys-cloud-mcp-server")
    "env" (dict
      "GENESYSCLOUD_REGION" (trim (gopass "yarrl/genesys/bnp/region"))
      "GENESYSCLOUD_OAUTHCLIENT_ID" (trim (gopass "yarrl/genesys/bnp/client/id"))
      "GENESYSCLOUD_OAUTHCLIENT_SECRET" (trim (gopass "yarrl/genesys/bnp/client/secret"))
    )
  )
  "genesys_inpost" (dict
    "command" "npx"
    "args" (list "-y" "@makingchatbots/genesys-cloud-mcp-server")
    "env" (dict
      "GENESYSCLOUD_REGION" (trim (gopass "yarrl/genesys/inpost/region"))
      "GENESYSCLOUD_OAUTHCLIENT_ID" (trim (gopass "yarrl/genesys/inpost/client/id"))
      "GENESYSCLOUD_OAUTHCLIENT_SECRET" (trim (gopass "yarrl/genesys/inpost/client/secret"))
    )
  )
  "github" (dict
    "command" "github-mcp-server"
    "args" (list "stdio" "--toolsets=all")
    "env" (dict
      "GITHUB_PERSONAL_ACCESS_TOKEN" (trim (gopass "personal/github/tokens/personal"))
    )
  )
  "grep_app" (dict
    "command" "grep-mcp"
    "args" (list)
  )
  "openai_developer_docs" (dict
    "type" "http"
    "url" "https://developers.openai.com/mcp"
  )
  "packages" (dict
    "command" "npx"
    "args" (list "-y" "package-registry-mcp")
  )
  "playwright" (dict
    "command" "playwright-mcp"
    "args" (list "--browser=webkit" "--isolated")
  )
  "slack_mirabridge" (dict
    "command" "slack-mcp-server"
    "args" (list "--transport" "stdio")
    "env" (dict
      "SLACK_MCP_XOXC_TOKEN" (trim (gopass "mirabridge/slack/xoxc"))
      "SLACK_MCP_XOXD_TOKEN" (trim (gopass "mirabridge/slack/xoxd"))
    )
  )
  "snyk" (dict
    "command" "snyk"
    "args" (list "mcp" "-t" "stdio")
  )
  "terraform" (dict
    "command" "terraform-mcp-server"
    "args" (list "stdio")
  )
-}}

{{- $_ := set $existing "mcpServers" $mcpServers -}}
{{ mustToPrettyJson $existing }}
